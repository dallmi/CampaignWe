// ============================================================================
// Schema Explorer - Discover data structure for CampaignWe click events
// ============================================================================
// Run each query separately in App Insights > Logs.
//
// KEY FINDING: customDimensions has only ONE key: "CustomProps".
// All fields (PageURL, Email, GPN, etc.) are inside CustomProps.
// Access pattern:  cd = todynamic(customDimensions)
//                  CP = todynamic(tostring(cd.CustomProps))
//                  then CP.PageURL, CP.Email, CP.GPN, etc.
// ============================================================================


// =========================================================================
// QUERY 0: Find event names for gwm-prompt-library page
// =========================================================================
customEvents
| where timestamp >= ago(7d)
| extend cd = todynamic(customDimensions)
| extend CP = todynamic(tostring(cd.CustomProps))
| where tostring(CP.PageURL) contains 'gwm-prompt-library'
| summarize count() by name
| order by count_ desc


// =========================================================================
// QUERY 1: All CustomProps keys with sample values
// =========================================================================
// customEvents
// | where timestamp >= ago(7d)
// | extend cd = todynamic(customDimensions)
// | extend CP = todynamic(tostring(cd.CustomProps))
// | where tostring(CP.PageURL) contains 'gwm-prompt-library'
// | extend cpKeys = bag_keys(CP)
// | mv-expand cpKey = cpKeys to typeof(string)
// | extend cpValue = tostring(CP[cpKey])
// | summarize KeyCount = count(), SampleValue = take_any(cpValue) by Key = tostring(cpKey)
// | order by KeyCount desc


// =========================================================================
// QUERY 2: Sample raw events (see full structure)
// =========================================================================
// customEvents
// | where timestamp >= ago(7d)
// | extend cd = todynamic(customDimensions)
// | extend CP = todynamic(tostring(cd.CustomProps))
// | where tostring(CP.PageURL) contains 'gwm-prompt-library'
// | take 10
